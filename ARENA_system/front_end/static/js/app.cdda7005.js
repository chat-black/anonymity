(function(e){function t(t){for(var i,s,n=t[0],r=t[1],c=t[2],h=0,u=[];h<n.length;h++)s=n[h],Object.prototype.hasOwnProperty.call(l,s)&&l[s]&&u.push(l[s][0]),l[s]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);d&&d(t);while(u.length)u.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],i=!0,n=1;n<a.length;n++){var r=a[n];0!==l[r]&&(i=!1)}i&&(o.splice(t--,1),e=s(s.s=a[0]))}return e}var i={},l={app:0},o=[];function s(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=i,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(a,i,function(t){return e[t]}.bind(null,i));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],r=n.push.bind(n);n.push=t,n=n.slice();for(var c=0;c<n.length;c++)t(n[c]);var d=r;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0156":function(e,t,a){"use strict";a("fa7c")},"034f":function(e,t,a){"use strict";a("85ec")},"1cee":function(e,t,a){},"2aff":function(e,t,a){e.exports=a.p+"static/img/step3.82c89a00.jpg"},3775:function(e,t,a){},"4d1a":function(e,t,a){"use strict";a("a82f")},"56d7":function(e,t,a){"use strict";a.r(t);var i=a("a026"),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},o=[],s={name:"App"},n=s,r=(a("034f"),a("2877")),c=Object(r["a"])(n,l,o,!1,null,null,null),d=c.exports,h=a("8c4f"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"hello"},[a("el-container",{staticClass:"layout-container"},[a("el-header",{staticClass:"el-header"},[a("div",{staticClass:"title"},[a("span",[e._v("ARENA")])])]),a("el-container",[a("el-aside",{staticStyle:{height:"90vh"},attrs:{width:"300px"}},[a("el-scrollbar",{staticStyle:{height:"100%"},attrs:{wrapStyle:"overflow-x:hidden;"}},[a("el-menu",{attrs:{"active-text-color":"#409EFF","default-active":"2-1-1"}},[a("el-submenu",{attrs:{index:"1"},scopedSlots:e._u([{key:"title",fn:function(){return[a("i",{staticClass:"el-icon-s-data"}),a("span",[e._v("Database Information")])]},proxy:!0}])},e._l(e.tableList,(function(t,i){return a("el-submenu",{key:i,attrs:{index:i},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(i))]},proxy:!0}],null,!0)},e._l(t,(function(t,i){return a("el-menu-item",{key:i,attrs:{index:i}},[e._v(" "+e._s(i)+" ("+e._s(t)+") ")])})),1)})),1),a("el-submenu",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{index:"6"},scopedSlots:e._u([{key:"title",fn:function(){return[a("i",{staticClass:"el-icon-s-operation"}),a("span",[e._v("Method")])]},proxy:!0}])},[a("el-menu-item",{attrs:{index:"6-1"}},[a("el-radio-group",{on:{change:e.methodChange},model:{value:e.methodRadio,callback:function(t){e.methodRadio=t},expression:"methodRadio"}},[a("el-radio",{staticClass:"smallRightMargin",attrs:{label:0}},[e._v("TIPS")]),a("el-radio",{staticClass:"smallRightMargin",attrs:{label:1}},[e._v("Cost")]),a("el-radio",{staticClass:"smallRightMargin",attrs:{label:2}},[e._v("Random")])],1)],1)],1),a("el-submenu",{attrs:{index:"2"},scopedSlots:e._u([{key:"title",fn:function(){return[a("i",{staticClass:"el-icon-s-order"}),a("span",[e._v("Parameter")])]},proxy:!0}])},[a("el-menu-item-group",{staticClass:"largeMenuItem"},[a("el-menu-item",{staticClass:"noHighLight",attrs:{index:"2-1-1"}},[a("el-form",{attrs:{"label-width":"90px","label-position":"left",rules:e.formRule,model:e.queryForm,size:"mini"}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:0===e.methodRadio,expression:"methodRadio === 0"}],attrs:{label:"Model"}},[a("el-switch",{attrs:{"active-text":"I-TIPS","inactive-text":"B-TIPS"},model:{value:e.queryForm.mode,callback:function(t){e.$set(e.queryForm,"mode",t)},expression:"queryForm.mode"}})],1),a("el-form-item",{attrs:{label:"Tree Edit dist"}},[a("el-switch",{model:{value:e.queryForm.editFlag,callback:function(t){e.$set(e.queryForm,"editFlag",t)},expression:"queryForm.editFlag"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.queryForm.mode,expression:"!queryForm.mode"}],attrs:{label:"Number"}},[a("el-input",{model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number",t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:"S_weight"}},[a("el-input",{model:{value:e.queryForm.s_weight,callback:function(t){e.$set(e.queryForm,"s_weight",t)},expression:"queryForm.s_weight"}})],1),a("el-form-item",{attrs:{label:"C_weight"}},[a("el-input",{model:{value:e.queryForm.c_weight,callback:function(t){e.$set(e.queryForm,"c_weight",t)},expression:"queryForm.c_weight"}})],1),a("el-form-item",{attrs:{label:"Cost_weight"}},[a("el-input",{model:{value:e.queryForm.cost_weight,callback:function(t){e.$set(e.queryForm,"cost_weight",t)},expression:"queryForm.cost_weight"}})],1),a("el-form-item",{attrs:{label:"lambda"}},[a("el-input",{model:{value:e.queryForm.lambda,callback:function(t){e.$set(e.queryForm,"lambda",t)},expression:"queryForm.lambda"}})],1),a("el-form-item",{attrs:{label:"Filter Limit"}},[a("el-input",{model:{value:e.queryForm.filter,callback:function(t){e.$set(e.queryForm,"filter",t)},expression:"queryForm.filter"}})],1)],1)],1)],1)],1),a("el-submenu",{attrs:{index:"5"},scopedSlots:e._u([{key:"title",fn:function(){return[a("i",{staticClass:"el-icon-s-tools"}),a("span",[e._v("Setting")])]},proxy:!0}])},[a("el-menu-item",{attrs:{index:"5-1"}},[a("el-switch",{attrs:{"active-text":"Compare Plan"},model:{value:e.isComparePlan,callback:function(t){e.isComparePlan=t},expression:"isComparePlan"}})],1),a("el-menu-item",{attrs:{index:"5-2"}},[a("el-switch",{attrs:{"active-text":"Different Color"},model:{value:e.isDifferentColor,callback:function(t){e.isDifferentColor=t},expression:"isDifferentColor"}})],1),a("el-menu-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{index:"5-2"}},[a("el-switch",{attrs:{"active-text":"Early Access"},on:{change:e.changeEarlyAccess},model:{value:e.isEarlyAccess,callback:function(t){e.isEarlyAccess=t},expression:"isEarlyAccess"}})],1)],1),a("el-submenu",{attrs:{index:"3"},scopedSlots:e._u([{key:"title",fn:function(){return[a("i",{staticClass:"el-icon-s-comment"}),a("span",[e._v("Suggest")])]},proxy:!0}])},[a("el-menu-item-group",{staticStyle:{height:"130px"}},[a("el-menu-item",{staticClass:"noHighLight",attrs:{index:"3-1"}},[a("el-input",{staticStyle:{"font-size":"13px"},attrs:{type:"textarea",rows:6,placeholder:"Please input your suggestion."},model:{value:e.userSuggestion,callback:function(t){e.userSuggestion=t},expression:"userSuggestion"}})],1)],1),a("el-menu-item-group",[a("el-menu-item",{attrs:{index:"3-2"}},[a("el-button",{attrs:{size:"mini"},on:{click:e.submitSuggest}},[e._v("Submit")])],1)],1)],1),a("el-submenu",{attrs:{index:"4"},scopedSlots:e._u([{key:"title",fn:function(){return[a("i",{staticClass:"el-icon-question"}),a("span",[e._v("Help")])]},proxy:!0}])},[a("el-menu-item",{attrs:{index:"4-1"}},[a("router-link",{attrs:{tag:"a",target:"_blank",to:"about"}},[e._v(" About ")])],1)],1)],1)],1)],1),a("el-main",[a("el-row",{staticClass:"el-row",attrs:{gutter:20}},[a("el-col",{staticClass:"el-col",attrs:{span:9}},[a("el-row",{staticClass:"el-row"},[a("el-input",{attrs:{type:"textarea",placeholder:"Input your SQL or select an example SQL",autosize:{minRows:10,maxRows:20}},model:{value:e.SQLstatement,callback:function(t){e.SQLstatement=t},expression:"SQLstatement"}})],1),a("el-row",{staticClass:"el-row",attrs:{gutter:10}},[a("el-col",{staticClass:"el-col",attrs:{span:7}},[a("el-select",{attrs:{placeholder:"Example SQL",clearable:""},on:{change:function(t){return e.loadSQLFile(t)},clear:e.clearTextarea},model:{value:e.selectedSQL,callback:function(t){e.selectedSQL=t},expression:"selectedSQL"}},e._l(e.SQLFiles,(function(t){return a("el-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),a("el-col",{staticClass:"el-col",attrs:{span:2}},[a("el-button",{attrs:{loading:e.isLoading,type:"primary"},on:{click:e.submitSQL}},[e._v("Execute")])],1)],1),a("el-row",{staticClass:"el-row"},[a("el-col",{staticClass:"el-col"},[e.tableData.length>0?a("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[e.tableData.length>0?a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"highlight-current-row":"","default-sort":{prop:"number"},stripe:""},on:{"row-click":e.handleTableSelect}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{attrs:{inline:""}},[a("el-form-item",{attrs:{label:"Cost"}},[a("span",[e._v(e._s(t.row.cost))])])],1)]}}],null,!1,3309897612)}),a("el-table-column",{attrs:{width:"60px",prop:"number",label:"Id",sortable:""}}),a("el-table-column",{attrs:{prop:"s_dist",label:"S_dist",sortable:""}}),a("el-table-column",{attrs:{prop:"c_dist",label:"C_dist",sortable:""}}),a("el-table-column",{attrs:{prop:"cost_dist",label:"Cost_dist"}}),a("el-table-column",{attrs:{prop:"relevance",label:"Relevance"}})],1):e._e()],1):e._e()],1)],1)],1),a("el-col",{staticClass:"el-col",attrs:{span:15}},[a("el-card",{directives:[{name:"show",rawName:"v-show",value:null!=e.needToDraw,expression:"needToDraw != null"}],staticClass:"box-card"},[a("draw-tree",{ref:"drawTree"})],1)],1)],1)],1)],1)],1)],1)},f=[],p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.g_loading,expression:"g_loading"}],staticStyle:{width:"calc(100% - 10px)",height:"calc(100vh - 140px)"}},[a("SeeksRelationGraph",{ref:"seeksRelationGraph",attrs:{options:e.graphOptions,"on-node-click":e.handleClickNode}})],1)])},m=[],g=a("0491"),b=a.n(g),v={name:"DrawTree",components:{SeeksRelationGraph:b.a},data(){return{g_loading:!0,graphOptions:{layouts:[{label:"中心",layoutName:"tree",defaultJunctionPoint:"border",defaultNodeShape:0,defaultLineShape:1,centerOffset_y:0,min_per_width:"60",min_per_height:"150",max_per_height:"300"}],allowShowMiniToolBar:!1,defaultExpandHolderPosition:"bottom",defaultLineShape:4,defaultJunctionPoint:"tb",defaultNodeShape:1,defaultNodeWidth:"50",defaultNodeHeight:"250",defaultNodeBorderWidth:0,defaultNodeColor:"#f8e3c5",defaultNodeFontColor:"#606266",defaultLineColor:"#606266",moveToCenterWhenResize:!1,allowShowMiniNameFilter:!1}}},created(){},mounted(){this.setGraphData({rootId:1,nodes:[{id:1,text:"",color:"white",width:100,height:50}],links:[]},!1)},methods:{setGraphData(e,t){this.setDiffColor(e,t),setTimeout(function(){this.g_loading=!1,this.$refs.seeksRelationGraph.setJsonData(e,e=>{})}.bind(this),1e3)},handleClickNode(e,t){let a=localStorage.getItem("isEarlyAccess");console.log(a),"false"!==a&&(""!==e.data.info&&void 0!==e.data.info?this.$notify({title:"Index Info",message:e.data.info}):console.log("nothing to show: ",e.data.info))}}},w=v,_=Object(r["a"])(w,p,m,!1,null,"3d326fb7",null),S=_.exports,y={name:"HelloWorld",components:{DrawTree:S},data(){return{dbName:"school",tableList:{},SQLstatement:"",selectedSQL:"",SQLFiles:[],isLoading:!1,tableData:[],isComparePlan:!1,isDifferentColor:!0,isEarlyAccess:!1,userSuggestion:"",queryForm:{mode:!1,editFlag:!1,s_weight:.33,c_weight:.33,cost_weight:.33,lambda:.5,number:5,filter:.5},formRule:{number:[{type:"number",min:0,max:20}]},needToDraw:null,methodRadio:0}},methods:{methodChange(e){0!==e&&(this.queryForm.mode=!1)},getSQLFiles(){this.$axios.get("/sqlFile").then(e=>{for(var t in e.data)this.SQLFiles.push(e.data[t]);this.SQLFiles.sort((function(e,t){return Number(e.split(".")[0])-Number(t.split(".")[0])}))}).catch(e=>{console.log(e),this.SQLFiles=[]})},getDBInfo(){this.$axios.get("/databaseInfo/"+this.dbName).then(e=>{this.tableList=JSON.parse(e.data)}).catch(e=>{console.log(e),this.tableList={"I can't get the database infomation.":{"Cat't":"get dbInfo"}}})},getCookie(e){let t=document.cookie,a=t.split("; ");for(let i of a){let t=i.split("=");if(t[0]===e)return t[1]}return""},checkForm(){let e=["s_weight","c_weight","cost_weight","lambda","filter"];for(let t of e){let e=this.queryForm[t];if(void 0===e||0===e.length)return this.$message({message:t+" is empty!",showClose:!0,type:"warning"}),!1;if(e=parseFloat(e),e<0||e>1)return this.$message({message:t+" range is [0, 1]",showClose:!0,type:"warning"}),!1}return!0},clearTextarea(){this.clearCookie("pid"),this.SQLstatement="",this.tableData=[],this.needToDraw=null},loadSQLFile(e){if(this.clearCookie("pid"),this.selectedSQL.length>0){var t="/sqlFile/"+this.selectedSQL;this.$axios.get(t).then(e=>{this.SQLstatement=e.data}).catch(e=>{console.log("I can't get the content of sql file, the name is: "+this.selectedSQL),console.log(e),this.SQLstatement="I can't load the sql file ╮(╯-╰)╭"}),this.tableData=[],this.needToDraw=null}},submitSQL(){if(""===this.SQLstatement)return void this.$message({message:"Please input the SQL!",showClose:!0,type:"warning"});if(!this.checkForm())return;this.isLoading=!0;let e=new FormData,t=this.SQLstatement.toLowerCase(),a=t.split("\n");for(let o=0;o<a.length;o++){let e=a[o],t=e.indexOf("--");-1!==t&&(e=e.substring(0,t)),a[o]=e}t=a.join("\n"),t=t.replace(/\s+/g," "),e.append("statement",t),e.append("fileName",this.selectedSQL);for(let o in this.queryForm)e.append(o,this.queryForm[o]);e.append("method",this.methodRadio);let i=this.queryForm["mode"],l=this.queryForm["mode"].toString()+this.queryForm["s_weight"].toString()+this.queryForm["editFlag"].toString()+this.queryForm["c_weight"].toString()+this.queryForm["cost_weight"].toString()+this.queryForm["lambda"].toString();l!==localStorage.getItem("formInfo")&&(this.clearCookie("pid"),localStorage.setItem("formInfo",l)),this.$axios.post("/search",e,{header:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{if(console.log(e.data),!1===i&&(this.tableData=[],this.clearCookie("pid")),!0===i){let t=e.data.flag;if(!0===t["clear"]&&(this.tableData=[]),e.data=[[this.tableData.length,e.data.data]],!0===t["end"])return this.$message({message:"No more plan",showClose:!0,type:"warning"}),void(this.isLoading=!1)}let t,a;for(let i in e.data){let l={rootId:null,nodes:[],links:[],TABLE:{},SCAN:{},JOIN:{},diffInfo:null};t={number:e.data[i][0]},a=JSON.parse(e.data[i][1]),t.cost=a.cost.toFixed(1),t.c_dist=a.c_dist.toFixed(2),t.s_dist=a.s_dist.toFixed(2),t.cost_dist=a.cost_dist.toFixed(2),t.relevance=a.relevance.toFixed(2),t.workerType=a.workerType,localStorage[t.number]=t.workerType;let o=1,s=a.content;s.parent="-1";let n=[s],r=(new Date).getTime().toString();l.rootId=this.selectedSQL+"_"+t.number+"_1_"+s.name+"_"+r;while(n.length>0){let e=n.length;for(let a=0;a<e;a++){let e=n.shift(),a={id:this.selectedSQL+"_"+t.number+"_"+o.toString()+"_"+e.name+"_"+r,text:e.name+"\nCost:"+e.cost.toFixed(1),width:100,height:50,data:{info:""}};if(""!==e.info&&(a.data.info=e.info),e.id=a.id,"TABLE"===e.tag?(l.TABLE[a.id]=!0,a.text=e.name):"SCAN"===e.tag?l.SCAN[a.id]=!0:"JOIN"===e.tag&&(l.JOIN[a.id]=!0),o++,l.nodes.push(a),"-1"!==e.parent){let t={from:e.parent,to:a.id};l.links.push(t)}if(e.child_flag)for(let t of e.child)t.parent=a.id,n.push(t)}}l.diffInfo=this.generateDiffInfo(a.content),t.tree=l,this.tableData.push(t)}this.isLoading=!1}).catch(e=>{this.$message({message:"SQL Execution Failed",showClose:!0,type:"error"}),this.isLoading=!1,console.log(e)})},submitSuggest(){if(""===this.userSuggestion)return void this.$message({message:"suggestion is empty!",showClose:!0,type:"warning"});let e=new FormData;e.append("uid",this.getCookie("uid")),e.append("suggestion",this.userSuggestion),this.$axios.post("/suggest",e,{header:{"Content-Type":"application/x-www-form-urlencoded"}}).then(()=>{this.$message({message:"thank you for your suggestion!",showClose:!0,type:"success"}),this.userSuggestion=""}).catch(e=>{this.$message({message:"Can't send the suggestion.",showClose:!0,type:"error"}),console.log(e)})},handleTableSelect(e){if(!1===this.isComparePlan){this.needToDraw=e.tree;for(let e=0;e<this.needToDraw.nodes.length;e++)delete this.needToDraw.nodes[e].flated;this.$refs.drawTree.setGraphData(this.needToDraw,this.isDifferentColor)}else{let t=(new Date).getTime().toString()+"_"+this.selectedSQL+"_"+e.number,a=null;for(let e of this.tableData)0===e.number&&(a=e);for(let o=0;o<e.tree.nodes.length;o++)delete e.tree.nodes[o].flated;for(let e=0;e<a.tree.nodes.length;e++)delete a.tree.nodes[e].flated;let i=JSON.stringify([a.tree,e.tree]);localStorage.setItem(t,i),localStorage.setItem(t+"diffColor",this.isDifferentColor);let l=this.$router.resolve({path:"/compareTree",query:{index:t}});window.open(l.href)}},generateDiffInfo(e){let t=this.generateScanInfo(e),a={};for(let s of t)for(let e in s)a[e]=s[e];let i=this.generateJoinTree(e),l=this.generateJoinInfo(i),o={};return o["scanInfo"]=a,o["joinInfo"]=l,o},generateScanInfo(e){let t=e;if(0===Object.keys(t).length)return[];if("SCAN"===t.tag){let e=t.child,a={};return a[e[0].name]=[t.name,e[0].id],[a]}let a=[];for(let i of t.child){let e=this.generateScanInfo(i);e.length>0&&(a=a.concat(e))}return a},generateJoinInfo(e){let t={level:{},map:{}},a=1,i=[e];while(0!==i.length){let e=i.length;t.level[a]=[];for(let l=0;l<e;l++){let e=i.shift();if("JOIN"===e.tag){t.level[a].push(e.id);let l=[];for(let t of e.child)l.push(t.id),i.push(t);t.map[e.id]=l}}a++}a--,delete t.level[a];for(let l=1,o=a-1;l<o;l++,o--){let e=t.level[l];t.level[l]=t.level[o],t.level[o]=e}return t},generateJoinTree(e){let t=e;if(0===Object.keys(t).length)return{};if("TABLE"===t.tag)return{tag:t.tag,id:t.id,child:[]};if("JOIN"===t.tag){let e={tag:t.tag,id:t.id,child:[]};for(let a of t.child){let t=this.generateJoinTree(a);Object.keys(t).length>0&&e.child.push(t)}return e}return t.child.length>1?{}:this.generateJoinTree(t.child[0])},changeEarlyAccess(e){localStorage.setItem("isEarlyAccess",e.toString())},clearCookie(e){let t=new Date;t.setTime(t.getTime()+-864e5);let a="expires="+t.toUTCString();document.cookie=e+"=; "+a}},mounted(){this.getSQLFiles(),this.getDBInfo(),localStorage.setItem("isEarlyAccess","false"),localStorage.setItem("formInfo","")}},x=y,C=(a("caca"),a("0156"),Object(r["a"])(x,u,f,!1,null,"529acf15",null)),T=C.exports,I=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"about"},[i("el-container",{staticClass:"layout-container"},[i("el-header",{staticClass:"el-header"},[i("div",{staticClass:"title"},[i("span",[e._v("ARENA")])])]),i("el-main",{attrs:{id:"largeFont"}},[i("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[i("el-collapse-item",{attrs:{title:"What is ARENA?",name:"1"}},[i("div",{staticStyle:{"font-size":"16px"}},[i("ul",[i("li",[e._v(" ARENA is a system that helps users learn database optimization knowledge. ")]),i("li",[e._v(" For a SQL, it will return not only the optimal plan whose execution time is smallest but also k valuable alternative plans. ")]),i("li",[e._v(" Users can learn the optimization knowledge used in the optimizer and why the plan is optimal by comparing the difference between alternative plans and the optimal plan. ")])])])]),i("el-collapse-item",{attrs:{title:"How to use it?",name:"2"}},[i("el-collapse",{staticStyle:{"margin-left":"14px"},attrs:{accordion:""}},[i("div",{attrs:{id:"mediumFont"}},[i("el-collapse-item",{attrs:{title:"Step 1",name:"3"}},[i("el-card",{attrs:{"body-style":{padding:"0px"},shadow:"hover"}},[i("div",{staticStyle:{"text-align":"center","margin-top":"14px"}},[i("img",{staticClass:"image",attrs:{src:a("f33d")}})]),i("div",{staticStyle:{padding:"14px","font-size":"16px"}},[i("span",[e._v('First step, enter a SQL statement or select an SQL instance, then click the "Execute" button.')])])])],1),i("el-collapse-item",{attrs:{title:"Step 2",name:"4"}},[i("el-card",{attrs:{"body-style":{padding:"0px"},shadow:"hover"}},[i("div",{staticStyle:{"text-align":"center","margin-top":"14px"}},[i("img",{staticClass:"image",attrs:{src:a("848d")}})]),i("div",{staticStyle:{padding:"14px","font-size":"16px"}},[i("span",[e._v('Second step, after clicking the "Execute" button and returning successfully, you will get a table like this where each row represents a plan. The plan with id 0 is the best plan and others are alternative plans. The information represented by each column in the table is:')]),i("ul",[i("li",[e._v(" Cost: Execution cost of each plan. The costs are measured in arbitrary units determined by the planner's cost parameters. Traditional practice is to measure the costs in units of disk page fetches. For convenience, you can think of it as execution time. ")]),i("li",[e._v(" S_dist: Structural distance between the current plan and the best plan ")]),i("li",[e._v(" C_dist: The content distance between the current plan and the best plan ")]),i("li",[e._v(" Cost_dist: The distance between the execution time of the current plan and the best plan ")]),i("li",[e._v(" relevance: The relevance defined in Section 4.3 . ")])]),i("span",[e._v(" If you click on a row, the detailed plan tree for that plan will be displayed on the right. ")])])])],1),i("el-collapse-item",{attrs:{title:"Step 3",name:"5"}},[i("el-card",{attrs:{"body-style":{padding:"0px"},shadow:"hover"}},[i("div",{staticStyle:{"text-align":"center","margin-top":"14px"}},[i("img",{staticClass:"image",attrs:{src:a("2aff")}})]),i("div",{staticStyle:{padding:"14px","font-size":"16px"}},[i("span",[e._v("Third step, the sidebar displays some additional information and provides some control options.")]),i("ul",[i("li",[e._v(" Database Information: This section shows the details of the database, what tables it contains, and the fields of each table. ")]),i("li",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(" Method: In this part you can decide how ARENA chooses informative plans. "),i("ul",[i("li",[i("b",[e._v(" TIPS: This is the method that we proposed in paper. ")])]),i("li",[e._v(" Cost: return plans with the least cost besides the best plan. ")]),i("li",[e._v(" Random: random select plans to show. ")])])]),i("li",[e._v(" Parameter: In this part you can adjust the parameters of the algorithm execution. "),i("ul",[i("li",[i("b",[e._v("Model ")]),e._v(": use batch TIPS or incremental TIPS. This parameter is only valid for TIPS. ")]),i("li",[i("b",[e._v("Tree Edit dist")]),e._v(": use the subtree kernel (default) or TreeEditDistance to calculate the structure difference. ")]),i("li",[i("b",[e._v("Number")]),e._v(": how many informative plans will be displayed. ")]),i("li",[i("b",[e._v("S_weight, C_weight, Cost_weight ")]),e._v(": when calculating plan difference, the weight of each part. ")]),i("li",[i("b",[e._v("lambda")]),e._v(": the trade-off between relevance and difference when calculating the plan interestingness defined in Section 4.4. When lambda = 0, plan interestingness contains only the difference. ")]),i("li",[i("b",[e._v("Filter limit")]),e._v(": when use the GFP strategy, if the structure difference between a plan and the best plan(QEP) is greater than a distance threshold, it will be filtered out. This parameter sets the value of distance threshold. ")])])]),i("li",[e._v(" Setting: "),i("ul",[i("li",[e._v(" Compare Plan: If you turn it on, when you click on the table in Step 2, a graph of the difference between the best plan and the current plan will be drawn. ")]),i("li",[e._v(" Different Color: whether to use different colors to represent different operators in the plan tree. ")])])]),i("li",[e._v(" Suggest: If you have any suggestions for ARENA, whether it's the features or the UI, you can send it to us through this section. ")]),i("li",[e._v(" Help: Show this page. ")])])])])],1)],1)])],1)],1)],1)],1)],1)},F=[],k={name:"About",data(){return{activeNames:""}}},N=k,D=(a("aedd"),a("4d1a"),Object(r["a"])(N,I,F,!1,null,"47a65f30",null)),L=D.exports,q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"compareTree"}},[a("el-container",{staticClass:"layout-container"},[a("el-header",{staticClass:"el-header"},[a("div",{staticClass:"title"},[a("span",[e._v("ARENA")])]),a("div",{staticClass:"compareTreeMenu"},[a("el-menu",{staticClass:"el-menu",attrs:{"background-color":"#C6E2FF","active-text-color":"#606266",mode:"horizontal"}},[a("el-submenu",{attrs:{index:"1"}},[a("template",{slot:"title"},[e._v("Setting")]),a("el-menu-item",{staticClass:"compareTreeMenu",attrs:{index:"1-1"}},[a("el-switch",{attrs:{"active-text":"Show Difference Info"},model:{value:e.showDiff,callback:function(t){e.showDiff=t},expression:"showDiff"}})],1),a("el-menu-item",{staticClass:"compareTreeMenu",attrs:{index:"1-1"}},[a("el-switch",{attrs:{"active-text":"Show ToolTip"},model:{value:e.showToolTip,callback:function(t){e.showToolTip=t},expression:"showToolTip"}})],1)],2)],1)],1)]),a("el-container",[a("el-aside",{directives:[{name:"show",rawName:"v-show",value:e.showDiff,expression:"showDiff"}],staticStyle:{height:"90vh"},attrs:{width:"300px"}},[a("el-collapse",{staticClass:"my-collapse",model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-collapse-item",{attrs:{title:"SCAN DIFFERENCE",name:"1"}},[e.isScanDiff?e._e():a("div",[e._v(" The scan operation of tables is same. ")]),e.isScanDiff?a("div",{staticClass:"diffTable"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Click to locate the operator",placement:"top","hide-after":"2000",disabled:!e.showToolTip}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.scanTableData,"highlight-current-row":"","default-sort":{prop:"name"}},on:{"row-click":e.tableRowSelect}},[a("el-table-column",{attrs:{prop:"name",label:"Name"}}),a("el-table-column",{attrs:{prop:"qep",label:"QEP"}}),a("el-table-column",{attrs:{prop:"ap",label:"AP"}})],1)],1)],1):e._e()]),e.isJoinDiff?a("el-collapse-item",{attrs:{title:"JOIN DIFFERENCE",name:"2"}},[1===e.isJoinDiff?a("div",[e._v(" The join operation of tables is same. ")]):e._e(),2===e.isJoinDiff?a("div",[e._v(" The join tree structure is different. ")]):e._e(),3===e.isJoinDiff?a("div",{staticClass:"diffTable"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top","hide-after":"4000",disabled:!e.showToolTip}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v("Click '>' to show more info. "),a("br"),a("br"),e._v(" Click row to locate the operator.")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.joinTableData,"highlight-current-row":"","default-sort":{prop:"order"}},on:{"row-click":e.tableRowSelect}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"QEP"}},[a("span",[e._v(e._s(t.row.qep))])]),a("el-form-item",{attrs:{label:"AP"}},[a("span",[e._v(e._s(t.row.ap))])])],1)]}}],null,!1,2802590729)}),a("el-table-column",{attrs:{prop:"order",label:"Order"}}),a("el-table-column",{attrs:{prop:"message",label:"Description",width:"170px"}})],1)],1)],1):e._e()]):e._e()],1)],1),a("el-main",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-card",[a("div",[a("div",{staticStyle:{width:"calc(100% - 10px)",height:"calc(100vh - 140px)"}},[a("SeeksRelationGraph",{ref:"bestRelationGraph",attrs:{options:e.graphOptions,"on-node-click":e.handleClickNode}})],1)]),a("div",{staticStyle:{"text-align":"center","font-size":"large",color:"#409EFF"}},[e._v(" Best Plan (QEP) ")])])],1),a("el-col",{attrs:{span:12}},[a("el-card",[a("div",[a("div",{staticStyle:{width:"calc(100% - 10px)",height:"calc(100vh - 140px)"}},[a("SeeksRelationGraph",{ref:"selectedRelationGraph",attrs:{options:e.graphOptions,"on-node-click":e.handleClickNode}})],1)]),a("div",{staticStyle:{"text-align":"center","font-size":"large",color:"#409EFF"}},[e._v(" Alternative Plan (AP): "+e._s(e.planId)+" ")])])],1)],1)],1)],1)],1)],1)},E=[],O={name:"CompareTree",components:{SeeksRelationGraph:b.a},data(){return{data_index:this.$route.query.index,data_buffer:null,planId:null,showDiff:!0,showToolTip:!0,isScanDiff:!1,isJoinDiff:1,scanTableData:[],joinTableData:[],activeName:["1","2"],graphOptions:{layouts:[{label:"中心",layoutName:"tree",defaultJunctionPoint:"border",defaultNodeShape:0,defaultLineShape:1,centerOffset_y:0,min_per_width:"60",min_per_height:"150",max_per_height:"300"}],allowShowMiniToolBar:!1,defaultExpandHolderPosition:"bottom",defaultLineShape:4,defaultJunctionPoint:"tb",defaultNodeShape:1,defaultNodeWidth:"50",defaultNodeHeight:"250",defaultNodeBorderWidth:0,defaultNodeColor:"#f8e3c5",defaultNodeFontColor:"#606266",defaultLineColor:"#606266",moveToCenterWhenResize:!1,allowShowMiniNameFilter:!1}}},mounted(){let e;null==this.data_buffer&&(this.data_buffer=JSON.parse(localStorage[this.data_index]),console.log("树的信息为：",this.data_buffer),e=localStorage[this.data_index+"diffColor"],e="true"===e,localStorage.removeItem(this.data_index),localStorage.removeItem(this.data_index+"diffColor"));let t=this.data_index.split("_");this.planId=t[t.length-1],this.setDiffInfo(this.data_buffer[0],this.data_buffer[1]),this.setDiffColor(this.data_buffer[0],e),this.setDiffColor(this.data_buffer[1],e),setTimeout(function(){this.$refs.bestRelationGraph.setJsonData(this.data_buffer[0],e=>{})}.bind(this),1e3),setTimeout(function(){this.$refs.selectedRelationGraph.setJsonData(this.data_buffer[1],e=>{})}.bind(this),1e3)},methods:{clearStorage(){localStorage.clear()},tableRowSelect(e){this.$refs.bestRelationGraph.focusNodeById(e["qepId"]),this.$refs.selectedRelationGraph.focusNodeById(e["apId"])},handleClickNode(e,t){"false"!==localStorage.getItem("isEarlyAccess")&&""!==e.data.info&&void 0!==e.data.info&&this.$notify({title:"Index Info",message:e.data.info})},setDiffInfo(e,t){let a=e.diffInfo.scanInfo,i=t.diffInfo.scanInfo;for(let c in a)a[c][0]!==i[c][0]&&(this.isScanDiff=!0,this.scanTableData.push({name:c,qep:a[c][0],ap:i[c][0],qepId:a[c][1],apId:i[c][1]}));let l={},o=e.diffInfo.joinInfo.level,s=e.diffInfo.joinInfo.map,n=t.diffInfo.joinInfo.level,r=t.diffInfo.joinInfo.map;if(0!==Object.keys(o).length)if(Object.keys(o).length===Object.keys(n).length){for(let e in o)if(o[e].length!==n[e].length)return void(this.isJoinDiff=2);for(let e in o){let t=o[e],a=n[e];for(let i=0;i<t.length;i++){console.log(e,i);let o,n,c,d,h=t[i],u=a[i],f=s[h][0],p=s[h][1],m=r[u][0],g=r[u][1];if(console.log(f),f=this.getChildTable(f,l),p=this.getChildTable(p,l),m=this.getChildTable(m,l),g=this.getChildTable(g,l),l[h]={left:f,right:p},l[u]={left:m,right:g},o=e+"-"+(i+1),c=this.getNameFromId(h)+": ",d=this.getNameFromId(u)+": ",this.eqSet(f,m)&&this.eqSet(p,g)||this.eqSet(f,g)&&this.eqSet(p,m))if(this.eqSet(f,m)){if(c===d)continue;n="different join operator"}else n="different join order";else n="joined table is different";c=c+this.printSet(f)+" X "+this.printSet(p),d=d+this.printSet(m)+" X "+this.printSet(g),this.isJoinDiff=3,this.joinTableData.push({order:o,message:n,qep:c,ap:d,qepId:h,apId:u})}}}else this.isJoinDiff=2},eqSet(e,t){if(e.size!==t.size)return!1;for(let a of e)if(!t.has(a))return!1;return!0},printSet(e){let t="[ ";for(let a of e)t+=a,t+=" ";return t+="]",t},getNameFromId(e){return e.split("_")[3]},typeOfName(e){return-1!==e.indexOf("Join")?"JOIN":"TABLE"},getChildTable(e,t){return"JOIN"===this.typeOfName(this.getNameFromId(e))?new Set([...t[e].left,...t[e].right]):new Set([this.getNameFromId(e)])}}},A=O,R=(a("a481"),a("f803"),Object(r["a"])(A,q,E,!1,null,"8125c2e6",null)),Q=R.exports;i["default"].use(h["a"]);var P=new h["a"]({mode:"hash",routes:[{path:"/",name:"HelloWorld",component:T},{path:"/about",name:"about",component:L},{path:"/compareTree",name:"compareTree",component:Q}]}),J=a("5c96"),j=a.n(J),$=(a("0fae"),a("bc3a")),M=a.n($);i["default"].config.productionTip=!1,i["default"].use(j.a),M.a.defaults.baseURL="http://127.0.0.1:5000/",i["default"].prototype.$axios=M.a,i["default"].prototype.setDiffColor=function(e,t){if(t){let t=e.TABLE,a=e.SCAN,i=e.JOIN;for(let l=0;l<e.nodes.length;l++){let o=e.nodes[l].id,s=e.nodes[l].text;o in t?e.nodes[l].color="#f4f4f5":o in a?(e.nodes[l].color="#c6e2ff",-1!==s.search("TableScan")||(-1!==s.search("IndexScan")?e.nodes[l].fontColor="#F56C6C":-1!==s.search("IndexOnlyScan")&&(e.nodes[l].fontColor="#E6A23C"))):o in i?(e.nodes[l].color="#f8e3c5",-1!==s.search("HashJoin")||-1!==s.search("IndexNLJoin")&&(e.nodes[l].fontColor="#409EFF")):e.nodes[l].color="#c8c9cc"}}else if(1!==e.rootId)for(let a=0;a<e.nodes.length;a++)delete e.nodes[a].color,delete e.nodes[a].fontColor},new i["default"]({el:"#app",router:P,components:{App:d},template:"<App/>"})},"57f1":function(e,t,a){},"848d":function(e,t,a){e.exports=a.p+"static/img/step2.1347e91f.jpg"},"85ec":function(e,t,a){},a481:function(e,t,a){"use strict";a("3775")},a82f:function(e,t,a){},aedd:function(e,t,a){"use strict";a("c137")},c137:function(e,t,a){},caca:function(e,t,a){"use strict";a("1cee")},f33d:function(e,t,a){e.exports=a.p+"static/img/step1.d08d3282.jpg"},f803:function(e,t,a){"use strict";a("57f1")},fa7c:function(e,t,a){}});
//# sourceMappingURL=app.cdda7005.js.map